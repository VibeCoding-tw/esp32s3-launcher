[env:esp32s3-launcher]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200

; --- 1. MEMORY & FLASH SETTINGS ---
; Freenove S3 uses OPI PSRAM (Octal SPI) and 16MB Flash
board_build.arduino.memory_type = qio_opi
board_build.f_flash = 80000000L
board_build.flash_mode = qio
board_upload.flash_size = 16MB

; ⚠️ CRITICAL: Partition Scheme for BLE + WiFi ⚠️
; The standard partition is too small for the BLE stack. 
; Since you have 16MB flash, we use the large partition map.
board_build.partitions = default_16MB.csv

; --- 2. BUILD FLAGS ---
build_flags = 
    ; --- Camera Driver Tweaks ---
    ; Lower I2C frequency for stability
    -DCONFIG_SCCB_CLK_FREQ=100000
    ; Increase DMA buffer for video streaming
    -DCONFIG_CAMERA_DMA_BUFFER_SIZE_MAX=32768
    ; Bypass HM0360 PID check
    -DHM0360_PID=0
    
    ; --- PSRAM Settings (Required for Camera) ---
    -DBOARD_HAS_PSRAM
    -mfix-esp32-psram-cache-issue
    
    ; --- Debugging ---
    -DCORE_DEBUG_LEVEL=3

; --- 3. LIBRARY DEPENDENCIES ---
lib_deps =
    ; The camera driver is the only external dependency needed.
    ; (WiFi, BLE, Preferences, and WebServer are built-in)
    esp32-camera
